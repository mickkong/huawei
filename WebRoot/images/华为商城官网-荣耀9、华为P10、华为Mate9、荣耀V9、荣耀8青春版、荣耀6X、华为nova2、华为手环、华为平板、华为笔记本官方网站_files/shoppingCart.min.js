ec.pkg("ec.shoppingCart");ec.load("ajax",{loadType:"lazy"});ec.shoppingCart.checkToOrder=function(){var a=$("#cart-list input[name='skuIds']:checked");var f=$("#cart-list input[name='bundleIds']:checked");var b=[];a.each(function(){var i=$(this).closest("tbody");var g=this.value;var o=$("#quantity-"+g,i).val();var k=$("#quantity-"+g,i).attr("data-type");var l={};var n={};var m={};var h=$('input[name="extendIds"]',i).val();if(h){n.itemId=h;n.qty=o;n.itemType="S1";n.itemProp={main_skucode:g};b.push(n)}var j=$('input[name="accidentIds"]',i).val();if(j){m.itemId=j;m.qty=o;m.itemType="S6";m.itemProp={main_skucode:g};b.push(m)}if(o){l.itemId=g;l.qty=o;if(k=="1"){l.itemType="S0"}if(k=="8"){l.itemType="S0";l.itemProp={Internal_Purchase:"true"}}if(k=="2"){l.itemType="B"}if(k=="9"){l.itemType="B";l.itemProp={Internal_Purchase:"true"}}b.push(l)}});f.each(function(){var g=$(this).closest("tbody");var k=this.value;var j=$("#quantity-bundle-"+k,g).val();var h=$("#quantity-bundle-"+k,g).attr("data-type");var i={};if(j){i.itemId=k;i.qty=j;if(h=="2"){i.itemType="B"}if(h=="9"){i.itemType="B";i.itemProp={Internal_Purchase:"true"}}b.push(i)}});$("div.limitstock").remove();$("div.quotastock").remove();$("s.understock").remove();$("div.timerpromo").remove();$("#sc-action-tips").addClass("hide");if(b.length==0){$("#sc-cartInfo-totalOriginalPrice,#sc-cartInfo-totalOriginalPrice-s").html("&yen;0.00");$("#sc-cartInfo-minusPrice,#sc-cartInfo-minusPrice-s").html("&yen;0.00");$("#sc-cartInfo-totalPrice,#sc-cartInfo-totalPrice-s").html("&yen;0.00");return}var e=ec.lang.json.stringify(b);var c=new Date();var d={};d.cartReqJson=e;d.t=c.getTime();$.ajax({url:domainMain+"/order/shoppingCart/newCart.json",dataType:"jsonp",timeout:10000,traditional:true,data:d,success:function(g){if(!g.success||!g.cartInfo){return}else{var k=g.cartInfo;for(var m=0;m<k.productList.length;m++){var o=k.productList[m];$("#order-pro-"+o.skuId).find("td.tr-subtotal").html("<b>&yen;"+o.subtotal+"</b>");if(o.normalPrice!=o.salePrice){$("#order-pro-"+o.skuId).find("td.tr-subtotal").append("<span><i>\u7701</i><em>&yen; "+o.totalDiscountPrice+"</em></span>")}if(o.extendAccidentList){for(var l=0;l<o.extendAccidentList.length;l++){var n=o.extendAccidentList[l];$("#order-insurance-"+n.skuId).find("td.tr-subtotal").html("<b>&yen;"+n.subtotal+"</b>")}}}for(var m=0;m<k.bundlerList.length;m++){var h=k.bundlerList[m];$("#order-pro-bundle-"+h.bundleId).find("td.tr-subtotal").html("<b>&yen;"+(h.totalBundlePrice).toFixed(2)+"</b>");$("#order-pro-bundle-"+h.bundleId).find("td.tr-subtotal").append("<span><i>\u7701</i><em>&yen;"+h.totalDiscountPrice+"</em></span>")}$("#sc-cartInfo-totalOriginalPrice,#sc-cartInfo-totalOriginalPrice-s").html("&yen;"+k.totalOriginalPrice.toFixed(2));$("#sc-cartInfo-minusPrice,#sc-cartInfo-minusPrice-s").html("&yen;"+k.preferentialPrice.toFixed(2));$("#sc-cartInfo-totalPrice,#sc-cartInfo-totalPrice-s").html("&yen;"+k.totalPrice.toFixed(2));ec.shoppingCart._renderInventory(k)}}})};ec.shoppingCart.check=function(c){var b=$(c).closest("div");if(c.checked){b.addClass("selected");b.find("input[id^='box-']").attr("checked",true);var a=true;$("#cart-list .tr-check input[id^='box-']").each(function(d){if(!$(this).attr("checked")){a=false}});if(a){$("#checkAll-buttom,#checkAll-top,#checkAll-suspend").attr("checked",true)}}else{b.removeClass("selected");b.find("input[type=checkbox]").attr("checked",false);$("#checkAll-buttom,#checkAll-top,#checkAll-suspend").attr("checked",false)}ec.shoppingCart.checkToOrder()};ec.shoppingCart.checkAll=function(a){if($(a).attr("checked")){$("#cart-list input[id^='box-']").attr("checked",true);$("#cart-list").children(".order-pro-area").addClass("selected");ec.shoppingCart.checkToOrder()}else{$("#cart-list input[type=checkbox]").attr("checked",false);$("#cart-list").children(".order-pro-area").removeClass("selected");$("#sc-cartInfo-totalOriginalPrice,#sc-cartInfo-totalOriginalPrice-s").html("&yen;0.00");$("#sc-cartInfo-minusPrice,#sc-cartInfo-minusPrice-s").html("&yen;0.00");$("#sc-cartInfo-totalPrice,#sc-cartInfo-totalPrice-s").html("&yen;0.00");$("#sc-action-tips").addClass("hide");$("div.limitstock").hide();$("div.quotastock").hide();$("s.understock").hide();$("div.timerpromo").hide()}};ec.shoppingCart.confirm=function(){_paq.push(["trackLink","\u8d2d\u7269\u8f66-\u53bb\u7ed3\u7b97","link"," "]);ec.code.addAnalytics({hicloud:true});var a=$("#cart-list input[name='skuIds']:checked");var b=$("#cart-list input[name='bundleIds']:checked");if(a.length==0&&b.length==0){alert("\u8bf7\u81f3\u5c11\u9009\u4e2d\u4e00\u4e2a\u5546\u54c1\uff01");return}if(!ec.shoppingCart._checkUnderstockAndLimitstock()){return false}ec.binding.cart.withPhone(function(){ec.cart.jumpToConfirm(a,b)})};ec.shoppingCart._renderNum=function(){ec.ui.number("#cart-list input.shop-quantity",{max:999,min:1,minusBtn:'<a href="javascript:;" class="icon-minus-3 vam" title="\u51cf"><span>-</span></a>',plusBtn:'<a href="javascript:;" class="icon-plus-3 vam" title="\u52a0"><span>+</span></a>',onchange:function(e,b){var d=$(this),a=d.attr("data-skuId"),c=d.attr("data-type");ec.shoppingCart._updateNum(a,c,b)}})};ec.shoppingCart._checkUnderstockAndLimitstock=function(){var d=true;var c=function(g){return $(g).closest("table").find("input[type=checkbox]")};if($(".understock").length>0||$(".limitstock").length>0||$(".quotastock").length>0||$(".timerpromo").length){var f=$(".limitstock"),b=$(".understock"),a=$(".quotastock"),e=$(".timerpromo");if(f.length>0){f.each(function(g,h){if(c(h).attr("checked")){d=false;$("#tips-text-p").html("\u8d2d\u7269\u8f66\u5546\u54c1\u8fbe\u5230\u8d2d\u4e70\u4e0a\u9650\uff0c\u8bf7\u5904\u7406\u540e\u7ed3\u7b97");return false}})}else{if(b.length>0){b.each(function(g,h){if(c(h).attr("checked")){d=false;$("#tips-text-p").html("\u8d2d\u7269\u8f66\u6709\u5e93\u5b58\u4e0d\u8db3\u5546\u54c1\uff0c\u8bf7\u5904\u7406\u540e\u7ed3\u7b97");return false}})}else{if(a.length>0){a.each(function(g,h){if(c(h).attr("checked")){d=false;$("#tips-text-p").html("\u5185\u8d2d\u5546\u54c1\u5df2\u8d85\u51fa\u8d2d\u4e70\u9650\u5236\u914d\u989d\uff0c\u8bf7\u5904\u7406\u540e\u7ed3\u7b97");return false}})}else{if(e.length>0){e.each(function(g,h){if(c(h).attr("checked")){d=false;$("#tips-text-p").html("\u542b\u6709\u6d3b\u52a8\u672a\u5f00\u59cb\u6216\u8005\u5df2\u7ed3\u675f\u7684\u5546\u54c1\uff0c\u8bf7\u5904\u7406\u540e\u518d\u7ed3\u7b97");return false}})}}}}}if(d){$("#sc-action-tips").addClass("hide")}else{$("#sc-action-tips").removeClass("hide")}return d};ec.shoppingCart._faultTolerant=function(a,e,d){var b=null;if(e==2||e==9){b=$("#quantity-bundle-"+a)}else{b=$("#quantity-"+a)}var c=parseInt(b.val())-d;if(b!=null){b.data("ovalue",c);b.val(c)}};ec.shoppingCart._renderInventory=function(a){$("div.limitstock").remove();$("div.quotastock").remove();$("s.understock").remove();$("div.timerpromo").remove();$("#sc-action-tips").addClass("hide");var b=function(c,e,d){if(c&&c.length>0){$(e+c.join(","+e),"#cart-form").html(d).show()}};b(a.skuInventoryErrors,".understock-",'<s class="understock"></s>');b(a.skuLimitErrors,".limitstock-",'<div class="p-tips limitstock"><p>\u8fbe\u5230\u8d2d\u4e70\u4e0a\u9650</p></div>');b(a.skuLimitErrors,".normalLimitstock-",'<div class="sc-stock-tips limitstock"><div class="tips-style-1 tips-area"><i></i>\t<div class="tips-text"><p>\u8fbe\u5230\u8d2d\u4e70\u4e0a\u9650</p></div>\t<u></u></div></div>');b(a.skuValidTimeErrors,".timerpromo-",'<div class="sc-stock-tips timerpromo"><div class="tips-style-1 tips-area"><i></i><div class="tips-text"><p>\u6d3b\u52a8\u672a\u5f00\u59cb\u6216\u5df2\u7ecf\u7ed3\u675f</p></div><u></u></div></div>');b(a.skuInternalQuataErrors,".ngs-normalLimitstock-",'<div class="sc-stock-tips quotastock"><div class="tips-style-1 tips-area"><i></i>\t<div class="tips-text"><p>\u8fbe\u5230\u8d2d\u4e70\u4e0a\u9650</p></div>\t<u></u></div></div>');b(a.bundleInternalQuataErrors,".ngb-normalLimitstock-",'<div class="sc-stock-tips quotastock"><div class="tips-style-1 tips-area"><i></i>\t<div class="tips-text"><p>\u8fbe\u5230\u8d2d\u4e70\u4e0a\u9650</p></div>\t<u></u></div></div>')};ec.shoppingCart.del=function(f,g,c,e){if(!g&&$("#cart-list input[name='skuIds']:checked").length==0&&$("#cart-list input[name='bundleIds']:checked").length==0){alert("\u8bf7\u9009\u62e9\u60a8\u8981\u5220\u9664\u7684\u5546\u54c1\uff01");return}if(!ec.ui.confirm(f,g?"\u60a8\u786e\u8ba4\u8981\u5220\u9664\u8be5\u5546\u54c1\u5417\uff1f":"\u60a8\u786e\u8ba4\u8981\u5220\u9664\u8fd9\u4e9b\u5546\u54c1\u5417\uff1f")){return}var d={};if(g){d.sbs=g.toString();d.types=c;if(d.types===undefined){d.types="1"}else{d.types=c.toString()}if(e){d.ess=e}}else{var b=[];var a=[];$("#cart-list input[name='skuIds']:checked").each(function(){b.push(this.value);a.push(this.getAttribute("data-type"))});$("#cart-list input[name='bundleIds']:checked").each(function(){b.push(this.value);a.push(this.getAttribute("data-type"))});d.sbs=b.join(",");d.types=a.join(",")}ec.shoppingCart.del2Cart(d,function(j){var h=ec.util.cookie.get("cart-recover")||",",k=function(r,o,l){var n=h.indexOf(","+r+";");if(n==-1){h+=r+";"+o+","}else{var m=h.substring(n+r.toString().length+2,h.indexOf(",",n+1));o+=parseInt(m);h=h.replace(","+r+";"+m+",",","+r+";"+o+",")}},i=function(n,l){if(l=="2"||l=="9"){var m=parseInt($("#quantity-bundle-"+n).val(),10);$("#order-pro-bundle-"+n+" input[name=skuIds]").each(function(){k(this.value,m,l)})}else{if(l!="6"&&l!="7"){var m=parseInt($("#quantity-"+n).val(),10);k(n,m,l)}}};if(g){i(g,c)}else{$("input[name=bundleIds]:checked,input[name=skuIds]:checked","#cart-form").each(function(){i(this.value,this.getAttribute("data-type"))})}ec.cart.setRecover(h);ec.shoppingCart.refreshRecover();$("#cart-form").remove();$("div.sc-pro-list").nextUntil("#cart-empty-msg").remove();$("#cart-empty-msg").addClass("hide");$("#checkAll-top").attr("checked",true);$("#pro-recommend-area").hide();ec.shoppingCart.getCartVOFromOrder(ec.shoppingCart.convertCartItem(j))})};ec.shoppingCart.del2Cart=function(d,j){var h=d.types.split(",");var k=[];var f=[];var a=d.sbs.split(",");var g=a.length;for(var e=0;e<g;e++){if(h[e]==1){k.push(a[e])}else{if(h[e]==2){f.push(a[e])}}}ec.code.addAnalytics({hicloud:false,operate:true,optype:0,skuIds:k,bundleIds:f,custBundleIds:[],custSkuIds:[]});var b=new Date();d.t=b.getTime();var c={data:d,dataType:"jsonp",timeout:10000,timeoutFunction:function(){ec.ui.loading.hide();alert("\u64cd\u4f5c\u8d85\u65f6\uff0c\u8bf7\u91cd\u8bd5\uff01")},successFunction:function(i){if(!i.success){ec.ui.loading.hide();ec.showError(i);return}if(j){j(i)}ec.ui.loading.hide();return}};c.url=domainCart+"/cart/del.json";new ec.ajax().get(c)};ec.cart.batchDel=function(a){$.ajax({url:domainCart+"/cart/del.json?"+a,dataType:"jsonp",timeout:10000,traditional:true,success:function(b){},error:function(){}})};ec.cart.readd=function(a,d){var c=function(){ec.cart.removeSkuFromRecover(a,function(e){if(!e||e.length<3){$("#pro-recover-area").hide()}})};if($("#box-"+a).length>0){ec.shoppingCart._updateNum(a,1,d);c();ec.shoppingCart.refreshRecover();$("#pro-recommend-area").empty();ec.cart.initRecommend()}else{var b={skuIds:[a],quantity:[d],type:[1]};ec.cart.add(b,{successFunction:function(e){c();$("#cart-form").remove();$("div.sc-pro-list").nextUntil("#cart-empty-msg").remove();$("#cart-empty-msg").addClass("hide");$("#checkAll-top").attr("checked",true);$("#pro-recommend-area").hide();ec.shoppingCart.getCartVOFromOrder(ec.shoppingCart.convertCartItem(e));ec.shoppingCart.refreshRecover()},errorFunction:function(e){alert(e.msg)}},null,true)}};ec.cart.slider={size:0,index:0,prev:function(a){if(this.index<=0||this.size<6){return}this.index--;$("#pro-recommend-list").animate({left:-193*this.index},1000);$("#cart-img-next").attr("class","pro-scroller-forward");if(this.index==0){$("#cart-img-prev").attr("class","pro-scroller-back-disabled")}},next:function(a){if(this.index+5>=this.size||this.size<6){return}this.index++;$("#pro-recommend-list").animate({left:-193*this.index},1000);$("#cart-img-prev").attr("class","pro-scroller-back");if(this.index+5==this.size){$("#cart-img-next").attr("class","pro-scroller-forward-disabled")}}};ec.shoppingCart.refreshRecover=function(){$("#pro-recover-area").hide();var h=ec.util.cookie.get("cart-recover");if(h){h=h.split(",");var b={},j,g=[];for(var e=h.length-1;e>=0;e--){j=h[e].split(";");g.push(j[0]);b[j[0]]=j[1]}if(g.length>0){$.ajax({url:domainMain+"/product/queryInfo.json?skuId="+g.join("&skuId=")+"&t="+new Date().getTime(),dataType:"jsonp",timeout:10000,success:function(o){if(!o.success){return}var n=[],r=[],t,s;var l=ec.util.cookie.get("cart-foldingDoor");for(var m=0;m<o.data.length;m++){t=o.data[m];s=parseInt(b[t.skuId],10);if(m==0){r.push('<tr id="pro-recover-');r.push(t.skuId);r.push('"><td class="tr-pro"><a href="');r.push(domainMain);r.push("/product/");r.push(t.prdId);r.push(".html#");r.push(t.skuId);r.push('" target="_blank" title="');r.push(t.name);r.push('">');r.push(t.name);r.push("</a></td>");r.push('<td class="tr-quantity">');r.push(s+"</td>");r.push('<td class="tr-subtotal">&yen;');r.push(s*t.price);r.push("</td>");r.push('<td class="tr-operate"><a class="button-style-4 button-re-purchase" title="\u91cd\u65b0\u8d2d\u4e70" href="javascript:;" onclick="ec.cart.readd(');r.push(t.skuId);r.push(" , ");r.push(s);r.push(');return false;">\u91cd\u65b0\u8d2d\u4e70</a></td></tr>')}n.push('<tr id="pro-recover-');n.push(t.skuId);n.push('"><td class="tr-pro"><a href="');n.push(domainMain);n.push("/product/");n.push(t.prdId);n.push(".html#");n.push(t.skuId);n.push('" target="_blank" title="');n.push(t.name+'">');n.push(t.name);n.push("</a></td>");n.push('<td class="tr-quantity">');n.push(s);n.push("</td>");n.push('<td class="tr-subtotal">&yen;');n.push(s*t.price);n.push("</td>");n.push('<td class="tr-operate"><a class="button-style-4 button-re-purchase" title="\u91cd\u65b0\u8d2d\u4e70" href="javascript:;" onclick="ec.cart.readd(');n.push(t.skuId);n.push(" , ");n.push(s);n.push(');return false;">\u91cd\u65b0\u8d2d\u4e70</a></td></tr>')}if(o.data.length==1){$("#pro-delete-shop-start").hide();$("#pro-delete-shop-end").hide();$("#pro-recover-tb").html(r.join(""))}else{if(!l||l=="doorClose"){$("#pro-delete-shop-start").show();$("#pro-delete-shop-end").hide();$("#pro-recover-tb").html(r.join(""))}else{if(l=="doorOpen"){$("#pro-delete-shop-start").hide();$("#pro-delete-shop-end").show();$("#pro-recover-tb").html(n.join(""))}}$("#pro-delete-shop-start").unbind("click").bind("click",function(){ec.util.cookie.set("cart-foldingDoor","doorOpen");$("#pro-delete-shop-start").hide();$("#pro-delete-shop-end").show();$("#pro-recover-tb").html(n.join(""))});$("#pro-delete-shop-end").unbind("click").bind("click",function(){ec.util.cookie.set("cart-foldingDoor","doorClose");$("#pro-delete-shop-start").show();$("#pro-delete-shop-end").hide();$("#pro-recover-tb").html(r.join(""))})}$("#pro-recover-area").show()}})}}var d=$(".order-header").height();var f=$(".shortcut").height();var k=$(".sc-list").height();var a=$(window).height();var c=d+f+k;if(c>a){$("#suspend_balance").show();$("#center_balance").hide()}else{$("#suspend_balance").hide();$("#center_balance").show()}};ec.cart.initRecommend=function(){var a=[];$("input[name=skuIds]","#cart-form").each(function(){a.push(this.value)});if(a.length>0){$.ajax({url:domainMain+"/product/recommend.json?skuIds="+a.join("&skuIds=")+"&t="+new Date().getTime(),dataType:"jsonp",timeout:10000,success:function(e){if(!e.success||!e.data||e.data.length==0){return}var b=e.data.length;ec.cart.slider.size=b;var d=[],f;for(var c=0;c<b;c++){f=e.data[c];d.push("<li><div>");d.push('<p class="p-img"><a title="'+f.name);d.push('"  target="_blank" href="'+domainMain+"/product/");d.push(f.prdId+".html#"+f.skuId);d.push('"><img alt="'+f.name+'" src="');d.push(ec.mediaPath+f.photoPath+"142_142_");d.push(f.photoName+'"></a></p>');d.push('<p class="p-name"><a title="'+f.name);d.push('" target="_blank" href="'+domainMain+"/product/");d.push(f.prdId+".html#"+f.skuId+'">');d.push(f.name+"</a></p>");d.push('<p class="p-price"><b>\u00a5'+f.price);d.push("</b></p>");d.push('<p class="p-button"><a class="button-style-4 button-add-cart-3" href="javascript:;" title="\u52a0\u5165\u8d2d\u7269\u8f66" onclick="ec.cart.readd(');d.push(f.skuId);d.push(' , 1);return false;">\u52a0\u5165\u8d2d\u7269\u8f66</a></p>');d.push("</div></li>")}$("#pro-recommend-area").show();if(b>5){$("#cart-img-next").attr("class","pro-scroller-forward")}$("#pro-recommend-list").width(193*b).html(d.join(""));d=null}})}};ec.shoppingCart.buildTotalArea=function(b){var d=[];d.push('<div class="sc-total-area-fixed">');d.push('<div class="sc-total-area-tool clearfix">');d.push('<div class="sc-total-control">');d.push('<input id="checkAll-suspend" name="" class="vam" type="checkbox" checked><label class="vam" for="checkAll-buttom">\u5168\u9009</label><a class="vam" href="javascript:;" seed="cart-all-del">\u5220\u9664\u9009\u4e2d\u5546\u54c1</a>');d.push("</div>");d.push('<div class="sc-action-area fr clearfix">');d.push('<a class="button-style-1 button-go-checkout-2" href="javascript:;" seed="cart-pay">\u53bb\u7ed3\u7b97</a>');d.push('<div class="sc-action-tips hide">');d.push('<div class="tips-style-1 tips-area">');d.push("<i></i>");d.push('<div class="tips-text">');d.push("<p>\u8d2d\u7269\u8f66\u4e2d\u6709\u5e93\u5b58\u4e0d\u8db3\u5546\u54c1\uff0c\u8bf7\u5904\u7406\u540e\u7ed3\u7b97</p>");d.push("</div>");d.push("<s></s>");d.push("</div>");d.push("</div>");d.push("</div>");d.push('<div class="sc-total-price">');d.push('<table cellspacing="0" cellpadding="0" border="0">');d.push("<tbody>");d.push("<tr>");d.push("<th><em>\u5408\u8ba1(\u4e0d\u542b\u8fd0\u8d39)\uff1a</em></th>");d.push('<td><b id="sc-cartInfo-totalPrice-s">&yen;&nbsp;');d.push(b.totalPrice.toFixed(2));d.push("</b></td>");d.push("</tr>");d.push("<tr>");d.push('<th>\u603b\u8ba1\uff1a<span id="sc-cartInfo-totalOriginalPrice-s">&yen;');d.push(b.totalOriginalPrice.toFixed(2));d.push("</span></th>");d.push('<td>\u8282\u7701\uff1a<span id="sc-cartInfo-minusPrice-s">&yen;');d.push((b.totalOriginalPrice-b.totalPrice).toFixed(2));d.push("</span></td>");d.push("</tr>");d.push("</tbody>");d.push("</table>");d.push("</div>");d.push("</div>");d.push("</div>");$("#suspend_balance").html(d.join(""));var c=[];c.push('<div id="center_balance"><div id="cart-total-area" class="sc-total-area-tool clearfix ">');c.push('<div class="sc-total-control">');c.push('<input id="checkAll-buttom" type="checkbox" name="" class="vam" autocomplete="off" checked/><label class="vam" for="checkAll-buttom">\u5168\u9009</label>');c.push('<a class="vam"  href="javascript:;" seed="cart-all-del">\u5220\u9664\u9009\u4e2d\u5546\u54c1</a></div>');c.push('<div class="sc-action-area fr clearfix">');c.push('<a class="button-style-1 button-go-checkout-2" href="javascript:;" seed="cart-pay">\u53bb\u7ed3\u7b97</a>');c.push('<div class="sc-action-tips hide"><div class="tips-style-1 tips-area"><i></i><div class="tips-text"><p>\u8d2d\u7269\u8f66\u4e2d\u6709\u5e93\u5b58\u4e0d\u8db3\u5546\u54c1\uff0c\u8bf7\u5904\u7406\u540e\u7ed3\u7b97</p></div><s></s></div></div></div>');c.push('<div class="sc-total-price"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><th><em>\u5408\u8ba1(\u4e0d\u542b\u8fd0\u8d39)\uff1a</em></th>');c.push('<td><b id="sc-cartInfo-totalPrice">&yen;&nbsp;');c.push(b.totalPrice.toFixed(2));c.push('</b></td></tr><tr><th>\u603b\u8ba1\uff1a<span id="sc-cartInfo-totalOriginalPrice">&yen;');c.push(b.totalOriginalPrice.toFixed(2));c.push('</span></th><td>\u8282\u7701\uff1a<span id="sc-cartInfo-minusPrice">&yen;');c.push((b.totalOriginalPrice-b.totalPrice).toFixed(2));c.push("</span></td></tr></tbody></table></div></div></div>");var a=$(c.join(""));a.find("#sc-cartInfo-totalOriginalPrice").html("&yen;"+b.totalOriginalPrice.toFixed(2));a.find("#sc-cartInfo-minusPrice").html("&yen;"+b.preferentialPrice.toFixed(2));a.find("#sc-cartInfo-totalPrice").html("&yen;"+b.totalPrice.toFixed(2));return a};ec.shoppingCart.checkResultData=function(b){var a=true;if(b){if((!b.bundlerList||(b.bundlerList&&b.bundlerList.length==0))&&(!b.productList||(b.productList&&b.productList.length==0))){$("#cart-empty-msg").removeClass("hide");a=false}}else{$("#cart-empty-msg").removeClass("hide");a=false}return a};ec.shoppingCart.packageDate=function(a,b){ec.shoppingCart.getGlobleParamer(b)};ec.shoppingCart.getGlobleParamer=function(a){var d=$("#globleParameter");var c=domainMain+d.attr("context");var b=d.attr("mediaPath");a.context=c;a.mediaPath=b};ec.shoppingCart.createShoppingCart=function(f,b,d){f.html(ec.shoppingCart._template.parse("product-list",d));var g=d.couponList;var a=d.premiumsList;var c=$('<form id="cart-form" autocomplete="off" method="get"></form>').submit(ec.shoppingCart.confirm).append('<input type="hidden" name="state" value="1"/>').append(f);var e=$("div.sc-pro-list");e.append(c).after(b)};ec.shoppingCart.addButtonEventandCheckbox=function(){$("#checkAll-top").click(function(){$("#checkAll-buttom").attr("checked",this.checked);$("#checkAll-suspend").attr("checked",this.checked);ec.shoppingCart.checkAll(this)});$("#checkAll-buttom").click(function(){$("#checkAll-top").attr("checked",this.checked);$("#checkAll-suspend").attr("checked",this.checked);ec.shoppingCart.checkAll(this)});$("#checkAll-suspend").click(function(){$("#checkAll-top").attr("checked",this.checked);$("#checkAll-buttom").attr("checked",this.checked);ec.shoppingCart.checkAll(this)});$(".sc-total-control a").click(function(){ec.shoppingCart.del(this)});$(".sc-action-area a.button-go-checkout-2").click(ec.shoppingCart.confirm)};ec.shoppingCart.initCartTable=function(k){var f=k.cartInfo;if(!ec.shoppingCart.checkResultData(f)){return false}var c=$('<span id="cart-list"></span>');var i=ec.shoppingCart.buildTotalArea(f);ec.shoppingCart.packageDate(k,f);ec.shoppingCart.createShoppingCart(c,i,f);ec.shoppingCart.addButtonEventandCheckbox();ec.shoppingCart._renderNum();ec.shoppingCart._renderInventory(f);var e=$(".order-header").height();var h=$(".shortcut").height();var j=$(".sc-list").height();var a=$(window).height();var d=e+h+j;var g=$("#cart-total-area").height();var b=$("#cart-total-area").offset().top;if(d>a){$("#suspend_balance").show();$("#center_balance").hide()}else{$("#suspend_balance").hide();$("#center_balance").show()}$(window).scroll(function(){var l=$(this).scrollTop();if(b-l<a){$("#suspend_balance").hide();$("#center_balance").show()}else{$("#suspend_balance").show();$("#center_balance").hide()}if(b-l<0){$("#suspend_balance").show();$("#center_balance").hide()}});return true};ec.shoppingCart._updateNum=function(a,c,b){ec.ui.loading.show();ec.shoppingCart._arr=[];ec.shoppingCart.selectedPrdSkuId=a;ec.shoppingCart.selectedPrdSkuIdType=c;$("#cart-list input[id^='box-']:checked").each(function(){var d=this;var e={id:d.value,type:d.getAttribute("data-type")};ec.shoppingCart._arr.push(e)});new ec.ajax().submit({url:domainCart+"/cart/updateNum.json",data:{types:c,sbs:a,qty:b,t:new Date().getTime()},timeout:10000,timeoutFunction:function(){ec.ui.loading.hide();ec.shoppingCart._faultTolerant(a,c,b);alert("\u64cd\u4f5c\u8d85\u65f6\uff0c\u8bf7\u91cd\u8bd5\uff01")},errorFunction:function(){ec.ui.loading.hide();ec.shoppingCart._faultTolerant(a,c,b)},successFunction:function(j){try{if(!j.success){ec.ui.loading.hide();ec.shoppingCart._faultTolerant(a,c,b);ec.showError(j);return}ec.ui.loading.hide();var g=j.cart;var k=new Array();for(var h=0;h<g.length;h++){var d=g[h];var f=true;if(d.skuId){if(!($("#box-"+d.skuId).is(":checked"))&&d.productType!=6&&d.productType!=7){f=false}}else{if(d.bundleId){if(!($("#box-bundle-"+d.bundleId).is(":checked"))){f=false}}}if(f){k.push(d)}}if("1"==c||"8"==c){$("#box-"+a).attr("checked",true);ec.shoppingCart.check($("#box-"+a)[0])}else{if("2"==c||"9"==c){$("#box-bundle-"+a).attr("checked",true);ec.shoppingCart.check($("#box-bundle-"+a)[0])}}}catch(l){ec.shoppingCart._faultTolerant(a,c,b)}}})};ec.shoppingCart.initCartTableAndRecommend=function(){ec.shoppingCart.mergeCart(ec.shoppingCart.getCartItemsFromCart,ec.shoppingCart.getCartVOFromOrder)};ec.shoppingCart.getCartVOFromOrder=function(a){$.ajax({url:domainMain+"/order/shoppingCart/newCart.json",dataType:"jsonp",timeout:10000,traditional:true,data:a,success:function(b){if(ec.shoppingCart.initCartTable(b)){ec.cart.initRecommend()}if(b.cartInfo.cartDelParams){ec.cart.batchDel(b.cartInfo.cartDelParams)}},error:function(){}})};ec.shoppingCart.mergeCart=function(b,a){var d=ec.util.cookie.get("cartId");if(d&&d.length>0){var c=ec.util.cookie.get("isValCas");if(c&&"false"==c){$.ajax({url:"/account/load",type:"POST"});c=ec.util.cookie.get("isValCas")}if(ec.account.isLogin()){$.ajax({url:domainCart+"/cart/cache2cart.json?t="+new Date().getTime(),dataType:"jsonp",timeout:10000,cache:false,success:function(e){b(a)}})}else{b(a)}}else{b(a)}};ec.shoppingCart.getCartItemsFromCart=function(a){$.ajax({url:domainCart+"/cart/shoppingCart.json?t="+new Date().getTime(),dataType:"jsonp",timeout:10000,success:function(b){a(ec.shoppingCart.convertCartItem(b))}})};ec.shoppingCart.convertCartItem=function(m){var h=[];if(m.cart&&m.cart.length>0){for(var g=0;g<m.cart.length;g++){var b=m.cart[g];var k={};k.itemId=b.skuId;k.qty=b.quantity;if(b.productType=="1"){k.itemType="S0";var a=[];if(b.giftCartList&&b.giftCartList.length>0){for(var e=0;e<b.giftCartList.length;e++){var d={sbomCode:b.giftCartList[e].skuId};a.push(d)}}k.gifts=a}if(b.productType=="8"){k.itemType="S0";k.itemProp={Internal_Purchase:"true"}}if(b.productType=="6"){k.itemType="S1";k.itemProp={main_skucode:b.mainSkuId}}if(b.productType=="7"){k.itemType="S6";k.itemProp={main_skucode:b.mainSkuId}}if(b.productType=="2"){k.itemId=b.bundleId;k.itemType="B"}if(b.productType=="9"){k.itemId=b.bundleId;k.itemType="B";k.itemProp={Internal_Purchase:"true"}}h.push(k)}}var l=ec.lang.json.stringify(h);var c=new Date();var f={};f.cartReqJson=l;f.t=c.getTime();return f};ec.ready(function(){ec.shoppingCart._template=new ec.template($("#product-list-html").val());ec.shoppingCart.initCartTableAndRecommend();ec.shoppingCart.refreshRecover();var b=getUrlParaMap4CartBinding();var a=b.isSuccess;if(null!=a&&"0"==a){bindCartResult("ec-binding-phone")}});
